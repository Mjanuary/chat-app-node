window.app = {
    themes: {
        list: [
            {
                image: '1234.jpg',
                colors: {
                    primary: '#333',
                    secondary: '#777',
                    text: '#34343',
                    background: 'image1.jpg'
                }
            },
            {
                image: '1234.jpg',
                colors: {
                    primary: '#333',
                    secondary: '#777',
                    text: '#34343',
                    background: 'image1.jpg'
                }
            },
            {
                image: '1234.jpg',
                colors: {
                    primary: '#333',
                    secondary: '#777',
                    text: '#34343',
                    background: 'image1.jpg'
                }
            },
        ],
        selected: '01'
    },
    state: {
        selectedTheme: 0,
        isRegistered: false,
    }
};

window.data = {
    selected: null,
    root: {
        profile: {
            firstName: "",
            lastName: "",
            email: "",
            phone: "",
            country: ""
        },
        posts: [
            {
                image: 'images/image1.jpg',
                caption: 'hahahahahhahahahahahha'
            },                {
                image: 'images/image1.jpg',
                caption: 'hahahahahhahahahahahha',
            },
        ]

    },
    friends: [
        {
            profile: {
                firstName: "Alice",
                lastName: "emerance",
                email: "alice@gmail.com",
                gender: "Female",
                picture: 'images (5).jpg'
            },
            chats: [
                {
                    by: 'friend',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      ,
                    image: 'images/black-black-watch-cellphone-1841841.jpg'
                },
                {
                    by: 'me',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      ,
                    image: 'images/black-black-watch-cellphone-1841841.jpg'
                },
                {
                    by: 'friend',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                }
            ],
            posts: [
                {
                    image: 'images/image1.jpg',
                    caption: 'hahahahahhahahahahahha'
                },
                {
                    image: 'images/image2.jpg',
                    caption: 'hahahahahhahahahahahha'
                },
                {
                    image: 'images/image3.jpg',
                    caption: 'hahahahahhahahahahahha'
                }
        ]
        },
        {
            profile: {
                firstName: "Jonathan",
                lastName: "muhawenimana",
                email: "janviermuhawenimana@gmail.com",
                gender: "Male",
                picture: "images (9).jpg"
            },
            chats: [
                {
                    by: 'friend',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
                        date: '12/23/2019',
                        time: '12 :14'
            }
            },
                {
                    by: 'me',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                }
            ],
            posts: [
                {
                    image: 'images/profile/images (8).jpg',
                    caption: 'this is me'
                }
        ]
        },
        {
            profile: {
                firstName: "James",
                lastName: "Mahoro",
                email: "janviermuhawenimana@gmail.com",
                gender: "Male",
                picture: "images (10).jpg"

            },
            chats: [
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                }
            ],
            posts: [
                {
                    image: 'images/image1.jpg',
                    caption: 'hahahahahhahahahahahha'
                },
                {
                    image: 'images/image2.jpg',
                    caption: 'hahahahahhahahahahahha'
                },                {
                    image: 'images/image2.jpg',
                    caption: 'hahahahahhahahahahahha'
                },                {
                    image: 'images/image2.jpg',
                    caption: 'hahahahahhahahahahahha'
                },
                {
                    image: 'images/image3.jpg',
                    caption: 'hahahahahhahahahahahha'
                }
        ]
        },  {
            profile: {
                firstName: "Lucas",
                lastName: "KIZITO",
                email: "lucas@gmail.com",
                gender: "Male",
                picture: "images (3).jpg"

            },
            chats: [
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                }
            ],
            posts: []
        },  {
            profile: {
                firstName: "Manzi",
                lastName: "Pacifique",
                email: "mazi@gmail.com",
                gender: "Male",
                picture: "images (2).jpg"

            },
            chats: [
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                }
            ],
            posts: []
        },  {
            profile: {
                firstName: "Belise",
                lastName: "UWERA",
                email: "uwera@gmail.com",
                gender: "Female",
                picture: "images (4).jpg"

            },
            chats: [],
            posts: [
                {
                    image: 'images/profile/images (4).jpg',
                    caption: 'hahahahahhahahahahahha'
                }
        ]
        },  {
            profile: {
                firstName: "Aimerance",
                lastName: "momo",
                email: "janviermuhawenimana@gmail.com",
                gender: "Female",
                picture: "images (8).jpg"

            },
            chats: [
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                }],
            posts: []
        },  {
            profile: {
                firstName: "Kamanzi",
                lastName: "TURIKUMWE",
                email: "kamanzi@gmail.com",
                gender: "Male",
                picture: "images.jpg"

            },
            chats: [
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                } ],
            posts: [
                {
                    image: 'images/profile/images.jpg',
                    caption: 'hahahahahhahahahahahha'
                }
        ]
        },  {
            profile: {
                firstName: "James",
                lastName: "Mahoro",
                email: "janviermuhawenimana@gmail.com",
                gender: "Male",
                picture: "images (10).jpg"

            },
            chats: [
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                }],
            posts: [
                {
                    image: 'images/image1.jpg',
                    caption: 'hahahahahhahahahahahha'
                },
                {
                    image: 'images/image3.jpg',
                    caption: 'hahahahahhahahahahahha'
                }
        ]
        },  {
            profile: {
                firstName: "James",
                lastName: "Mahoro",
                email: "janviermuhawenimana@gmail.com",
                gender: "Male",
                picture: "images (10).jpg"

            },
            chats: [
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: ' hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'friend',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                },
                {
                    by: 'me',
                    msg: 'hello world we are recluting the people here on this challel',
                    date: {
            date: '12/23/2019',
            time: '12 :14'
}      
                }
            ],
            posts: [
                {
                    image: 'images/image1.jpg',
                    caption: 'hahahahahhahahahahahha'
                },
                {
                    image: 'images/image2.jpg',
                    caption: 'hahahahahhahahahahahha'
                },
                {
                    image: 'images/image3.jpg',
                    caption: 'hahahahahhahahahahahha'
                }
        ]
        }
    ]
}

// console.log(data);



    window.postSlide = {
        slide: {
            curent: 0,
            max: 0
        },
        userPost: {
            curent: 0,
            max: 0
        },
        active: false

    };


var dateTime = new Date();
// ALL THE USERS FROM THE DATABASE
window.DB = '';
// check if the users are loaded
window.dataLoaded = false;
// active user
window.USERS = {};
window.USER = {};
window.UID = '';

// load the datas
function loadMainData(callback) {
    axios.get('https://african-chat-app.firebaseio.com/users.json')
    .then((response) => {
        // handle success
        window.USERS = response.data;
        callback(response.data);

    })
    .catch(function (error) {
        
    })
    .finally(function () {

    });     
}

// find db
const findId = (id, success, from = window.USERS) => {
    let data = from;
    let found = false;
    for (const i in data) {
        let newOBJ = data[i];
        if (i == id) {
            found = true;
            newOBJ.key = i;
            // console.log(newOBJ);
            
            success(newOBJ);
            break;
        }
    }
    if (!found) {
        success({});
    }
}



const retId = (id) => {
    let data = window.USERS;
    let found = false;
    for (const i in data) {
        let newOBJ = data[i];
        if (i == id) {
            found = true;
            newOBJ.key = i;
            // console.log(newOBJ);
            
            return newOBJ;
            break;
        }
    }
    if (!found) {
        return {};
    }
}

// get user
const findDataDB = (key,value, success) => {
    let data = window.USERS;
    let found = false;
    for (const i in data) {
        let newOBJ = data[i];
        if (data[i][key] == value) {
            found = true;
            newOBJ.found = true;
            newOBJ.key = i;

            success(newOBJ);
            break;
        }
    }
    if (!found) {
        success({found: false});
    }
}



const generateFriendsList = (user) => {
    let newList = [];
    if (user.friends !== '') {
        for (var i in user.friends) {
            let subUser = user.friends[i];
            findId(subUser.friendKey, data => {
                subUser.details = data;
            });

            subUser.key = i;
            newList.push(subUser);
        }

        window.USER.oFriends = newList;        
    } else {
        window.USER.oFriends = newList;        
    }
}


            // console.log(retId(i));


function makeid(length) {
    var result           = '';
    var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    var charactersLength = characters.length;
    for ( var i = 0; i < length; i++ ) {
       result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
 }
// const friendRequests = () => {
//     const friends = window.USERS;


//     for (const i in friends) {

//     }
// }

const inviteFriendDB = id => {
    let chatKey = makeid(10);

    let userOBJ = {
        friendKey: id,
        groupId: chatKey,
        date: dateTime
    }

    // send group to the users
    axios.post(`https://african-chat-app.firebaseio.com/users/${id}/friends.json`,  userOBJ);
    axios.post(`https://african-chat-app.firebaseio.com/users/${window.UID}/friends.json`,  userOBJ);

    // add the friend to the objsct
    loadMainData((data) => {
        console.log('data updated');
        console.log(data);



        findId(sessionStorage.getItem("uid"), user => {
            window.USER = user;
            generateFriendsList(user);
            chattList();
            // console.log(window.USERS);

            // console.log('organized friends: ', window.USER.oFriends);
            // console.log('session: ', sessionStorage.getItem("uid"));
        }, data);




        generateFriendsList(user);
        chattList();
    })  
    if (this.USER.friends) {
        console.log('FOUND1');
    } else {
        console.log('NOT FOUND1');
    }
    console.log('USER: ', this.USER);
}
